s.record;
(s.scope.(~startRandomLetters);
s.meter;)
~startRandomLetters.();
(s.options.numOutputBusChannels = 16;
s.options.numWireBufs = 2048;
s.reboot;
s.waitForBoot({

    // Load buffer
    ~buf = Buffer.read(s, "/Users/mila/Supercollider/Sample/Miss You.wav", channels:[0]);
    // HOA Encoder / Decoder
    ~enc = HoaMatrixEncoder.newDirection(0, 0, \basic, 3);
    ~dec = HoaMatrixDecoder.newModeMatch(
        directions: [
            [36, 54], [108, 54], [180, 54], [-108, 54],
            [-36, 54], [36, 18], [108, 18], [180, 18],
            [-108, 18], [-36, 18], [0, -18], [72, -18],
            [144, -18], [-144, -18], [-72, -18], [0, -54]
        ].degrad,
        beamShape: \energy,
        match: \rms
    );

    // HOA movement function
    ~hoaMove = { |sig|
        sig = HoaEncodeMatrix.ar(sig, ~enc);
        sig = HoaRTT.ar(sig,
            rotate: SinOsc.kr(0.05, 0).range(-pi, pi),
            tilt: SinOsc.kr(0.03, 0).range(-pi/4, pi/4),
            tumble: SinOsc.kr(0.02, 0).range(-pi/6, pi/6)
        );
        HoaDecodeMatrix.ar(sig, ~dec)
    };

    // HOA SynthDef with random start position
    SynthDef(\SampleHOA, { |out=0, bufnum, pitch=1, dur=1|
        var sig, env, numFrames, sr, startPos;
        numFrames = BufFrames.kr(bufnum);
        sr = BufSampleRate.kr(bufnum);

        // Random start position for short snippet
        startPos = rrand(0, (numFrames - (dur * sr)).max(0));

        env = EnvGen.kr(Env.perc(0.01, dur, 1, -4), doneAction:2);

       sig = PlayBuf.ar(
			numChannels: 2,
			bufnum: bufnum,
			rate: pitch * BufRateScale.kr(bufnum),
			startPos: startPos,
			doneAction:2).sum * 0.5 * env; // sum stereo -> mono

        sig = ~hoaMove.(sig);
        Out.ar(out, sig);
    }).add;
    s.sync;
// SynthDef for "love" that plays full buffer without fading
SynthDef(\LoveHOA, { |out=0, bufnum, pitch=1|
    var sig;
    // Play full buffer with pitch scaling and HOA processing
    sig = PlayBuf.ar(
        numChannels: 2,
        bufnum: bufnum,
        rate: pitch * BufRateScale.kr(bufnum),
        loop: 0,          // play once
        doneAction: 2
    ).sum * 0.5;          // sum stereo to mono for HOA

    sig = ~hoaMove.(sig);
    Out.ar(out, sig);
}).add;
s.sync;

});

)

(
~alphabet = ["l","o","v","e"];
~randLetter = { ~alphabet.choose };
~running = false;

~startRandomLetters = {
    if(~running) { "Already running".postln; ^nil };
    ~running = true;

    ~task = Routine.run({
        var interval = 1.5; // 40 BPM
        var word;

        while({ ~running }) {
            word = Array.fill(4, { ~randLetter.value }).join;

            if(word == "love") {
                ("üíñ Could this finally be love?: %".format(word)).postln;
                "--> YES!!!".postln;
                ~running = false;
                Synth(\LoveHOA, [\bufnum, ~buf.bufnum, \pitch, 1]);
            } {
                ("Could this finally be love?: % (No)".format(word)).postln;
                word.do { |l|
                    Synth(\SampleHOA, [
                        \bufnum, ~buf.bufnum,
                        \pitch, rrand(0.9, 1.1),
                        \dur, 1
                    ]);
                };
            };

            interval.wait;
        };
    });
	("üé≤ What is the probability?").postln;
};

~stopRandomLetters = {
    ~running = false;
    if(~task.notNil) { ~task.stop; ~task = nil };
    "üõë Stopped.".postln;
};
)

























//----------------------------------------–æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±—É—Ñ–µ—Ä–∞
//----------------------------------------
(
Server.default = s = Server.local;

s.waitForBoot({
    ~buf = Buffer.read(s,"/Users/mila/Supercollider/Sample/Miss You.wav");

    // –°–∏–Ω—Ç –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç—Ä—ã–≤–∫–æ–≤ (1 —Å–µ–∫, —Å fade-out)
    SynthDef(\Sample, { |out=0, bufnum, pitch=0.2, dur=1, pan=0|
        var env, sig, startPos, numFrames, sr;

        numFrames = BufFrames.kr(bufnum);
        sr = BufSampleRate.kr(bufnum);

        // —Å—Ç–∞—Ä—Ç –ø–æ–∑–∏—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ
        startPos = TRand.kr(0, (numFrames - (dur * sr)).max(0), Dust.kr(1));

        env = EnvGen.kr(Env.perc(0.01, dur, 1, -4), doneAction:2);

        sig = PlayBuf.ar(
            2,                   // —Å—Ç–µ—Ä–µ–æ
            bufnum,
            rate: pitch * BufRateScale.kr(bufnum),
            startPos: startPos,
            doneAction:2
        ) * env;

        Out.ar(out, Pan2.ar(sig[0], sig[1], pan));
    }).add;

    // –°–∏–Ω—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –±—É—Ñ–µ—Ä–∞
    SynthDef(\Love, {
        Out.ar(0, PlayBuf.ar(2, ~buf, doneAction:2))
    }).add;

    "‚úÖ SynthDefs loaded and ready.".postln;
});
)

//----------------------------------------
// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –±—É–∫–≤
//----------------------------------------
(
~alphabet = ["l", "o", "v", "e"];
~randLetter = { ~alphabet.choose };
~running = false;

~startRandomLetters = {
    if(~running) { "Already running".postln; ^nil };
    ~running = true;

    ~task = Routine.run({
        var interval = 1; // 40 BPM (—Å–µ–∫—É–Ω–¥)
        var word;

        while({ ~running }) {
            word = Array.fill(4, { ~randLetter.value }).join;

            if(word == "love") {
                ("üíñ Could this finally be love?: %".format(word)).postln;
                "--> Yes".postln;
                ~running = false;
                Synth(\Love); // –ø–æ–ª–Ω—ã–π –±—É—Ñ–µ—Ä
            } {
                ("Could this finally be love?: % (No)".format(word)).postln;
                word.do { |l|
                    var pan = rrand(-1.0, 1.0);
                    var pitch = rrand(0.9, 1.1);
                    Synth(\Sample, [
                        \bufnum, ~buf.bufnum,
                        \pitch, pitch,
                        \dur, 1,
                        \pan, pan
                    ]);
                };
            };

            interval.wait;
        };
    });
    "üé≤ Random letters started (call ~stopRandomLetters.() to stop).".postln;
};

~stopRandomLetters = {
    ~running = false;
    if(~task.notNil) { ~task.stop; ~task = nil };
    "üõë Stopped.".postln;
};
)



~startRandomLetters.();




















(
Server.default = s = Server.local;

s.waitForBoot({
    ~buf = Buffer.read(s, "/Users/mila/Supercollider/Sample/Miss You.wav");

    SynthDef(\Sample, { |out=0, pitch=1, dur=1, pan=0, bufnum|
        var env, sig, startPos, numFrames, sr;

        numFrames = BufFrames.kr(bufnum);
        sr = BufSampleRate.kr(bufnum);

        startPos = TRand.kr(0, (numFrames - (dur * sr)).max(0), Dust.kr(1));

        env = EnvGen.kr(Env.perc(0.01, dur, 1, -4), doneAction:2);

        sig = PlayBuf.ar(
            2,
            bufnum,
            rate: pitch * BufRateScale.kr(bufnum),
            startPos: startPos,
            doneAction: 2
        ) * env;

        sig = Balance2.ar(sig[0], sig[1], pan);
        Out.ar(out, sig);
    }).add;

    SynthDef(\Love, {
        Out.ar(0, PlayBuf.ar(2, ~buf, doneAction:2));
    }).add;

    "‚úÖ Both SynthDefs loaded and ready.".postln;
});
)
)


//----------------------------------------
// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –±—É–∫–≤
//----------------------------------------
(
~alphabet = ["l", "o", "v", "e"];
~randLetter = { ~alphabet.choose };
~running = false;

~startRandomLetters = {
    if (~running) { "Already running".postln; ^nil };
    ~running = true;

    ~task = Routine.run({
        var interval = 2; // 40 BPM
        var word;

        while({ ~running }) {
            word = Array.fill(4, { ~randLetter.value }).join;

            if (word == "love") {
                ("üíñ Generated word: %".format(word)).postln;
                "--> target 'love' detected! Playing full sample...".postln;
                ~running = false;
                Synth(\Love); // –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é
            } {
                ("Generated word: % (not love)".format(word)).postln;

                // –∫–æ—Ä–æ—Ç–∫–∏–µ –∫—É—Å–æ—á–∫–∏ –∏–∑ –±—É—Ñ–µ—Ä–∞
                word.do { |l|
                    var pan = rrand(-1.0, 1.0);
                    var pitch = rrand(0.9, 1.1);
                    Synth(\Sample, [
                        \bufnum, ~buf.bufnum,
                        \pitch, pitch,
                        \dur, 1,
                        \pan, pan
                    ]);
                };
            };

            interval.wait;
        };
    });

    "üé≤ Random letters started (call ~stopRandomLetters.() to stop).".postln;
};

~stopRandomLetters = {
    ~running = false;
    if (~task.notNil) { ~task.stop; ~task = nil };
    "üõë Stopped.".postln;
};
)

~startRandomLetters.();













// supercollider_love.scd
// –ü—Ä–æ–µ–∫—Ç: —Å–ª—É—á–∞–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±—É–∫–≤, –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ "love" ‚Äî –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞—É–¥–∏–æ –∏–∑ –±—É—Ñ–µ—Ä–∞; –æ–¥–∏–Ω–æ—á–Ω—ã–µ –±—É–∫–≤—ã –≤—ã–∑—ã–≤–∞—é—Ç –∑–≤—É–∫ —Ç–∏–∫–∞–Ω—å—è —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º –ø–∏—Ç—á–µ–º
// –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å SC 3.13.0

//----------------------------------------
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±—É—Ñ–µ—Ä–∞ —Å –º–µ–ª–æ–¥–∏–µ–π
//----------------------------------------
(
Server.default = s = Server.local;

/*SynthDef –¥–ª—è —Ç–∏–∫–∞–Ω—å—è —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º –ø–∏—Ç—á–µ–º
SynthDef.new("tick", { |amp=0.2|
    var freq = 800 + Rand(-50,50); // –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–Ω –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ —Å –Ω–µ–±–æ–ª—å—à–æ–π –≤–∞—Ä–∏–∞—Ü–∏–µ–π
    var env = EnvGen.kr(Env.perc(0.01, 0.6, 1, -4), doneAction:2); // –±—ã—Å—Ç—Ä—ã–π –º—è–≥–∫–∏–π —Å—Ç–∞—Ä—Ç, –ø–ª–∞–≤–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
    var sig = SinOsc.ar(freq) * env; // –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–Ω
    sig = sig + SinOsc.ar(freq*1.5, 0, 0.3) * env; // –¥–æ–±–∞–≤–∏–º –æ–±–µ—Ä—Ç–∫—É –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∫–∏
    sig = sig + SinOsc.ar(freq*2.1, 0, 0.2) * env; // –µ—â–µ –≥–∞—Ä–º–æ–Ω–∏–∫–∞
    sig = sig * amp;
    Out.ar(0, (sig!2)); // —Å—Ç–µ—Ä–µ–æ
}).add;*/
 ~buf = Buffer.read(s,"/Users/mila/Supercollider/Sample/Miss You.wav" );

 SynthDef(\Sample, { |out=0, pitch=1|
    var sig;
    sig = PlayBuf.ar(1, ~buf, rate: pitch, doneAction:2);
    Out.ar(out, sig!2); // —Å—Ç–µ—Ä–µ–æ
}).add;

"Tick SynthDef added.".postln;
)

//----------------------------------------
//----------------------------------------
// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –±—É–∫–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 'love'
//----------------------------------------
(
~alphabet = ["l", "o", "v", "e"];
~randLetter = { ~alphabet.choose };

~running = false;

~startRandomLetters = {
    if(~running) { "Already running".postln; ^nil };
    ~running = true;

    ~task = Routine.run({
        var interval = 0.15;

        while({ ~running }) {
            // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ–≤–æ –∏–∑ 4 –±—É–∫–≤ —Å—Ä–∞–∑—É
            var word = Array.fill(4, { ~randLetter.value }).join;

            if(word == "love") {
                ("Generated word: %".format(word)).postln;
                "--> target 'love' detected! Playing audio from buffer...".postln;
                ~running = false; // –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
                b.play;
            } {
                ("Generated word: % (this was not love)".format(word)).postln;
                // –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º —Å—ç–º–ø–ª –¥–ª—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã
                word.do { |l| Synth(\Sample) }; // <-- –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º Synth
            };

            interval.wait;
        };
    });
    "Random letters started (call ~stopRandomLetters.() to stop).".postln;
};
)
~startRandomLetters.();

~startRandomLetters.();


















// supercollider_love.scd
// –ü—Ä–æ–µ–∫—Ç: —Å–ª—É—á–∞–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±—É–∫–≤, –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ "love" ‚Äî –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞—É–¥–∏–æ –∏–∑ –±—É—Ñ–µ—Ä–∞; –æ–¥–∏–Ω–æ—á–Ω—ã–µ –±—É–∫–≤—ã –≤—ã–∑—ã–≤–∞—é—Ç –∑–≤—É–∫ —Ç–∏–∫–∞–Ω—å—è
// –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å SC 3.13.0

//----------------------------------------
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±—É—Ñ–µ—Ä–∞ —Å –º–µ–ª–æ–¥–∏–µ–π
//----------------------------------------
(
Server.default = s = Server.local;

    // SynthDef –¥–ª—è —Ç–∏–∫–∞–Ω—å—è
    SynthDef.new("tick", { |amp=0.2|
        var sig = Impulse.ar(8) * Decay.ar(Impulse.ar(0), 0.05) * amp;
        sig = sig + WhiteNoise.ar(0.01) * sig; // –Ω–µ–º–Ω–æ–≥–æ —à—É–º–∞ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
        Out.ar(0, (sig!2));
    }).add;

    "Buffer allocated and tick SynthDef added.".postln;

)

//----------------------------------------
// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –±—É–∫–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 'love'
//----------------------------------------
(
~alphabet = ["a","b","c","d","e","f","g","h","i","j","k","l","m",
             "n","o","p","q","r","s","t","u","v","w","x","y","z"];
~randLetter = { ~alphabet.choose };

~running = false;

~startRandomLetters = {
    if(~running) { "Already running".postln; ^nil };
    ~running = true;

    ~task = Routine.run({
        var interval = 0.15;

        while({ ~running }) {
            var l = ~randLetter.value;

            if(l == "l") {
                var word = "l";
                3.do {
                    var nextLetter = ~randLetter.value;
                    word = word ++ nextLetter;
                };

                if(word == "love") {
                    ("Generated word: %".format(word)).postln;
                    "--> target 'love' detected! Playing audio from buffer...".postln;
                    b.play;
                } {
                    ("Generated word: % (this was not love)".format(word)).postln;
                };
            } {
                // –æ–¥–∏–Ω–æ—á–Ω–∞—è –±—É–∫–≤–∞
                ("Letter: %".format(l)).postln;
                Synth.new("tick");
            };

            interval.wait;
        };
    });
    "Random letters started (call ~stopRandomLetters.() to stop).".postln;
};

~stopRandomLetters = {
    ~running = false;
    if(~task.notNil) { ~task.stop; ~task = nil };
    "Stopped.".postln;
};
)
~startRandomLetters.();

